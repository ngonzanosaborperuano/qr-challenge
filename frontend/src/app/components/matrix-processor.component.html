<div *ngIf="!authService.isAuthenticated()" class="error">
  丘멆잺 Debes iniciar sesi칩n primero para procesar matrices.
</div>

<div *ngIf="authService.isAuthenticated()">
  <h2>Procesar Matriz</h2>
  
  <div class="form-group">
    <label for="matrixInput">Ingresa la matriz (formato JSON):</label>
    <textarea
      id="matrixInput"
      [(ngModel)]="matrixInput"
      name="matrixInput"
      rows="6"
      placeholder='[[1, 2, 3], [4, 5, 6], [7, 8, 9]]'
    ></textarea>
    <small>
      Ejemplo: [[1, 2, 3], [4, 5, 6], [7, 8, 9]]
    </small>
  </div>

  <button (click)="processMatrix()" [disabled]="loading || !matrixInput.trim()">
    {{ loading ? 'Procesando...' : 'Procesar Matriz' }}
  </button>

  <div *ngIf="error" class="error">{{ error }}</div>
  <div *ngIf="loading" class="loading">Procesando matriz...</div>

  <div *ngIf="result && !error" class="results-section">
    <div class="section-divider"></div>

    <h3>Matriz Rotada (90춿 horario)</h3>
    <div class="matrix-display">
      <pre>{{ result.rotated | matrixFormat }}</pre>
    </div>

    <h3>Matriz Q (Factorizaci칩n QR)</h3>
    <app-info-box type="info">
      <strong>쯈u칠 es la Factorizaci칩n QR?</strong><br>
      La factorizaci칩n QR descompone una matriz A en dos matrices: <strong>Q</strong> (ortogonal) y <strong>R</strong> (triangular superior), 
      donde <strong>A = Q 칑 R</strong>. La matriz Q contiene vectores ortonormales y R es triangular superior. 
      Esta descomposici칩n es 칰til en 치lgebra lineal, resoluci칩n de sistemas de ecuaciones y an치lisis num칠rico.
    </app-info-box>
    <div class="matrix-display">
      <pre>{{ result.q | matrixFormat }}</pre>
    </div>

    <h3>Matriz R (Factorizaci칩n QR)</h3>
    <app-info-box type="info">
      La matriz <strong>R</strong> es triangular superior (todos los elementos debajo de la diagonal principal son 0 o muy cercanos a 0).
    </app-info-box>
    <div class="matrix-display">
      <pre>{{ result.r | matrixFormat }}</pre>
    </div>

    <div *ngIf="result.nodeStats" class="section-divider"></div>
    <h3 *ngIf="result.nodeStats">Estad칤sticas</h3>
    <app-info-box type="warning">
      <strong>游늵 Nota sobre las estad칤sticas:</strong><br>
      Las estad칤sticas se calculan sobre <strong>todas las matrices</strong> (Q, R y matriz rotada). 
      El m칤nimo puede ser negativo porque las matrices Q y R pueden contener valores negativos como resultado 
      de la factorizaci칩n QR. Esto es <strong>completamente normal</strong> y matem치ticamente correcto.
    </app-info-box>
    
    <div *ngIf="result.nodeStats" class="stats-grid">
      <div class="stat-card">
        <div class="label">M치ximo</div>
        <div class="value">{{ result.nodeStats.max | number:'1.2-2' }}</div>
      </div>
      
      <div class="stat-card">
        <div class="label">M칤nimo</div>
        <div class="value">{{ result.nodeStats.min | number:'1.2-2' }}</div>
        <small *ngIf="result.nodeStats.min < 0">
          (Valor negativo es normal en QR)
        </small>
      </div>
      
      <div class="stat-card">
        <div class="label">Promedio</div>
        <div class="value">{{ result.nodeStats.avg | number:'1.2-2' }}</div>
      </div>
      
      <div class="stat-card">
        <div class="label">Suma Total</div>
        <div class="value">{{ result.nodeStats.sum | number:'1.2-2' }}</div>
      </div>
      
      <div class="stat-card">
        <div class="label">Es Diagonal</div>
        <div class="value">{{ result.nodeStats.anyDiagonal ? 'S칤' : 'No' }}</div>
      </div>
    </div>

    <div *ngIf="result.error" class="error">
      丘멆잺 Advertencia: {{ result.error }}
    </div>
  </div>
</div>

